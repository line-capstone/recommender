# 지지도, 신뢰도, 향상도

* 연관성 규칙의 효용성은 지지도, 신뢰도, 향상도 세 가지를 모두 반영해 평가한다.
* 임의의 규칙1이 규칙2보다 효과적인 규칙이라고 말하기 위해선, 세 지표가 모두 커야 한다.

## 지지도\(Support\)

* 두 품목 A와 B의 지지도는 **전체 거래 항목 중 항목 A와 항목 B가 동시에 포함되는 거래의 비율**을 말한다.​

$$
지지도 = Pr(A ∩ B) = A와 B가 동시에 포함된 거래 수 / 전체 거래 수
$$

* 참고로 A의 지지도는 P\(A\)이다. 왜냐하면, 품목 A를 포함하는 거래수를 전체거래수로 나누면, A품목이 거래될 확률이기 때문이다.

## 신뢰도\(Confidence\)

* 연관성 규칙 "If A, then B"의 신뢰도는 아래와 같다.

$$
P(B|A) = Pr(A∩B) / P(A) 
= 품목 A와 B가 동시에 포함된 거래 수 / 품목 A를 포함하는 거래 수
$$

## 지지도, 신뢰도의 적용

### 식료품에 대한 거래 내역 <a id="undefined"></a>

| 고객번호 | 품목 |
| :--- | :--- |
| 1 | 오렌지 쥬스, 사이다 |
| 2 | 우유, 오렌지 쥬스, 식기세척제 |
| 3 | 오렌지 쥬스, 세제 |
| 4 | 오렌지 쥬스, 세제, 사이다 |
| 5 | 식기 세척제, 사이다 |

### 동시구매표 <a id="2-3"></a>

| 구분 | 오렌지쥬스 | 식기세척제 | 우유 | 사이다 | 세제 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 오렌지쥬스 | 4 | 1 | 1 | 2 | 2 |
| 식기세척제 | 1 | 2 | 1 | 1 | 0 |
| 우유 | 1 | 1 | 1 | 0 | 0 |
| 사이다 | 2 | 1 | 0 | 3 | 1 |
| 세제 | 2 | 0 | 0 | 1 | 2 |

* "오렌지 쥬스를 사면, 사이다를 구매한다"의 지지도와 신뢰도
  * 지지도 = 2/5
    * '식료품에 대한 거래내역' 표를 보면, 총 거래수는 5이다.
    * 이 중 오렌지쥬스와 사이다가 동시에 구매된 거래수는 2이다.
  * 신뢰도 = 2/4
    * 오렌지쥬스는 총 4번 구매되었다.
    * 이 중 사이다가 동시에 구매된 거래수는 2이다.
* "우유와 오렌지 쥬스를 사면, 식기세척제를 산다"의 지지도와 신뢰도
  * 지지도 = 1/5
    * '식료품에 대한 거래내역' 표를 보면, 총 거래수는 5이다.
    * '식료품에 대한 거래내역' 표를 보면, 우유, 오렌지  쥬스, 식기세척제를 동시에 구매한 거래수는 1이다.
  * 신뢰도 = 1/1
    * 우유와 오렌지 쥬스를 동시에 구매한 거래수는 1이다.
    * 우유, 오렌지 쥬스, 식기세척제를 동시에 구매한 거래수는 1이다.

## 지지도, 신뢰도 예제

다음은 세 품목 A, B, C의 동시거래 내역이다.

| 항목 | 거래의 수 | 품목 | 거래의 수 |
| :--- | :--- | :--- | :--- |
| A | 100 | A + C | 300 |
| B | 150 | B + C | 200 |
| C | 200 | A + B + C | 100 |
| A + B | 400 | 추가 안함 | 550 |

* 전체거래 횟수 = 2,000

### 각 품목의 조합에 대한 지지도

각 항목의 거래수 / 2,000

| 항목 | 품목이 포함된 총 거래의 수 | 확률 | 항목 | 품목이 포함된 총 거래의 수 | 확률 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| A | 900 | 0.450 | A + C | 300 | 0.200 |
| B | 850 | 0.425 | B + C | 200 | 0.150 |
| C | 800 | 0.400 | A + B + C | 100 | 0.05 |
| A + B | 500 | 0.250 |  |  |  |

### 모든 연관성 규칙에 대한 신뢰도

| 규칙 | P\(A ∩ B\) | P\(A\) | 신뢰도 |
| :--- | :--- | :--- | :--- |
| A  B | 0.25 | 0.45 | 0.556 |
| B  A | 0.25 | 0.425 | 0.588 |
| C  B | 0.15 | 0.40 | 0.375 |
| B  C | 0.15 | 0.425 | 0.353 |
| A  C | 0.25 | 0.45 | 0.556 |
| C  A | 0.20 | 0.40 | 0.500 |
| \(A+B\)  C | 0.05 | 0.25 | 0.200 |
| \(B+C\)  A | 0.05 | 0.15 | 0.333 |
| \(A+C\)  B | 0.05 | 0.20 | 0.250 |

## 향상도\(Lift\)

* **향상도**는 아래의 두 가지 방법으로 설명할 수 있다.
  * **P\(B\|A\) / P\(B\)**: 품목 A가 주어지지 않았을 때의 품목 B의 확률 대비 품목 A가 주어졌을 때의 품목 B의 확률의 증가비율. 
  * **P\(A∩B\) / P\(A\)P\(B\)**: A를 구매한 사람이 B를 구매할 확률과 A의 구매와 상관없이 B를 구매할 확률의 비율.
* 세 가지 품목을 모두 포함하는 연관성 규칙 중 가장 신뢰도가 높은 규칙은 "B와 C를 구입하면, A도 구매한다"이며, 이 연관성 규칙의 신뢰도는 0.333이다. 그러나 전체 거래에서 품목 A의 거래가 일어날 가능성은 0.45이기 때문에 이 연관성 규칙은 실질적으로 의미 있는 규칙이 되지 못한다. 이런 경우 연관성 규칙의 성질을 향상도를 통해 파악할 수 있다.

$$
향상도 = 품목 A와 B가 포함된 거래 수 / (품목 A가 포함된 거래수 X 품목 B가 포함된 거래수)
$$

$$
P(A∩B) / P(A) P(B) = P(B|A)/P(B) = 신뢰도/P(B)
$$

* **향상도가 높을수록, 품목 A의 구매 여부가 품목 B의 구매 여부에 큰 영향**을 끼친다. 왜냐하면, 향상도가 높다는 것은 품목 A가 주어지지 않았을 때의 품목 B의 확률과 비교해서 품목 A가 주어졌을 때 품목 B의 확률이 더 크다는 것을 의미하기 때문이다.
* 향상도가 1이면, **독립**이다. 왜냐하면 A와 B 각각의 확률과 A와 B가 동시에 일어날 확률이 같기 때문에 독립이다. 향상도가 독립이라면, **규칙 사이에 유의미한 연관성이 없다**는 것을 의미한다.
* 향상도가 2라면, 두 사건이 독립이라는 것을 가정했을 때와 비교하여 **2배로 긍정적인 관계**를 나타낸다.
* 향상도가 1보다 크면, 두 사건이 독립일 때 대비 두 사건이 동시에 발생할 확률이 더 높으므로 두 사건은 **양의 상관관계**이다. 두 사건이 양의 상관관계라는 것은 두 제품을 개별적으로 구매할 확률보다 동시에 구매할 확률이 높다는 것을 의미한다. 
* 이와 반대로 향상도가 1보다 작으면, 두 사건은 **음의 상관관계**이다.

## references

* 김용대 교수님 수업 자료
* [ratsgo's blog](https://ratsgo.github.io/machine%20learning/2017/04/08/apriori/)

